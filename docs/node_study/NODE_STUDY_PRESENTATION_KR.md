# Node.js í”„ë¡œì íŠ¸ ë°œí‘œ (í•µì‹¬ ìš”ì•½)

## AI ê¸°ë°˜ ì´ë²¤íŠ¸ ë°ì´í„° ìƒì„± í”Œë«í¼ + ë©€í‹°ìœ ì € ì‹œìŠ¤í…œ

---

## ğŸ“Œ í”„ë¡œì íŠ¸ í•œ ì¤„ ì†Œê°œ

> Excel ìŠ¤í‚¤ë§ˆë¥¼ ì½ì–´ì„œ AIë¡œ í˜„ì‹¤ì ì¸ ì‚¬ìš©ì í–‰ë™ ë°ì´í„°ë¥¼ ìë™ ìƒì„±í•˜ê³ , ê³„ì •ë³„ë¡œ ê´€ë¦¬í•˜ëŠ” **Node.js ë°±ì—”ë“œ ì‹œìŠ¤í…œ**

---

## ğŸ¯ í•µì‹¬ ê¸°ëŠ¥

1. **Excel íŒŒì‹±** â†’ AI ë¶„ì„ â†’ **ìˆ˜ë°±ë§Œ ê°œ ì´ë²¤íŠ¸ ë°ì´í„° ìƒì„±**
2. **ë©€í‹°ìœ ì € ê³„ì • ì‹œìŠ¤í…œ** (JWT ì¸ì¦, íšŒì›ê°€ì…/ë¡œê·¸ì¸)
3. **ì‹¤í–‰ íˆìŠ¤í† ë¦¬ ê´€ë¦¬** (ì‚¬ìš©ìë³„ ë…ë¦½ ë°ì´í„°)
4. **íŒŒì¼ ê´€ë¦¬** (ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ/ì‚­ì œ)
5. **ìë™ ì „ì†¡** (LogBus2 â†’ ThinkingEngine)

---

## ğŸ’» Node.js í•µì‹¬ í™œìš©

| ì˜ì—­              | ê¸°ìˆ                 | ì½”ë“œ ì˜ˆì‹œ                             |
| ----------------- | ------------------- | ------------------------------------- |
| **REST API**      | Express.js          | `app.post('/api/auth/login', ...)`    |
| **íŒŒì¼ ì²˜ë¦¬**     | fs, multer, Stream  | `fs.createWriteStream()`, íŒŒì¼ ì—…ë¡œë“œ |
| **ë¹„ë™ê¸° ì²˜ë¦¬**   | async/await         | `await generator.generate()`          |
| **í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬** | child_process       | `spawn('logbus', ['start'])`          |
| **ë°ì´í„°ë² ì´ìŠ¤**  | Prisma + PostgreSQL | íƒ€ì… ì•ˆì „ ì¿¼ë¦¬                        |
| **ì¸ì¦**          | JWT + bcrypt        | í† í° ë°œê¸‰, ë¹„ë°€ë²ˆí˜¸ í•´ì‹±              |
| **í™˜ê²½ë³€ìˆ˜**      | dotenv              | `process.env.DATABASE_URL`            |
| **ìŠ¤ì¼€ì¤„ë§**      | setInterval         | 24ì‹œê°„ë§ˆë‹¤ íŒŒì¼ ì •ë¦¬                  |

---

## ğŸ“Š CRUD êµ¬í˜„ (4ê°œ ë„ë©”ì¸)

### 1ï¸âƒ£ **ì¸ì¦ (Authentication)**

| C        | R      | U   | D        |
| -------- | ------ | --- | -------- |
| íšŒì›ê°€ì… | ë¡œê·¸ì¸ | -   | ë¡œê·¸ì•„ì›ƒ |

### 2ï¸âƒ£ **ì‚¬ìš©ì ì„¤ì • (User Settings)**

| C         | R                        | U                        | D                                |
| --------- | ------------------------ | ------------------------ | -------------------------------- |
| ì„¤ì • ìƒì„± | ì„¤ì • ì¡°íšŒ                | ì„¤ì • ìˆ˜ì •                | ì„¤ì • ì‚­ì œ                        |
| -         | `GET /api/user/settings` | `PUT /api/user/settings` | `DELETE /api/user/settings/:key` |

### 3ï¸âƒ£ **ì‹¤í–‰ íˆìŠ¤í† ë¦¬ (Run History)**

| C                          | R               | U             | D                         |
| -------------------------- | --------------- | ------------- | ------------------------- |
| ë°ì´í„° ìƒì„±                | ëª©ë¡/ìƒì„¸ ì¡°íšŒ  | ìƒíƒœ ì—…ë°ì´íŠ¸ | ì‹¤í–‰ ì‚­ì œ                 |
| `POST /api/generate/start` | `GET /api/runs` | ìë™          | `DELETE /api/runs/:runId` |

### 4ï¸âƒ£ **íŒŒì¼ ê´€ë¦¬ (File Management)**

| C                        | R                  | U   | D                           |
| ------------------------ | ------------------ | --- | --------------------------- |
| íŒŒì¼ ì—…ë¡œë“œ              | íŒŒì¼ ëª©ë¡/ë‹¤ìš´ë¡œë“œ | -   | íŒŒì¼ ì‚­ì œ                   |
| `POST /api/files/upload` | `GET /api/files`   | -   | `DELETE /api/files/:fileId` |

---

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ (PostgreSQL + Prisma)

### ERD (í•µì‹¬ êµ¬ì¡°)

```
User (ì‚¬ìš©ì)
  â”œâ”€ 1:1 â†’ UserSetting (ì„¤ì •: APP_ID, API Keys)
  â”œâ”€ 1:N â†’ Run (ì‹¤í–‰ íˆìŠ¤í† ë¦¬)
  â””â”€ 1:N â†’ File (íŒŒì¼ ëª©ë¡)

Run (ì‹¤í–‰)
  â””â”€ 1:N â†’ File (ìƒì„±ëœ ë°ì´í„° íŒŒì¼)
```

### ì£¼ìš” í…Œì´ë¸”

#### **User** (ì‚¬ìš©ì)

```
id, email, password(bcrypt), name, createdAt
```

#### **UserSetting** (ì„¤ì •)

```
userId, appId, receiverUrl, anthropicApiKey(ì•”í˜¸í™”), openaiApiKey(ì•”í˜¸í™”)
```

#### **Run** (ì‹¤í–‰ íˆìŠ¤í† ë¦¬)

```
userId, runId, status, scenario, dau, industry,
dateStart, dateEnd, totalUsers, totalEvents, completedAt
```

#### **File** (íŒŒì¼)

```
userId, runId, fileName, filePath, fileType, fileSize, createdAt
```

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (ê°„ì†Œí™”)

```
[í”„ë¡ íŠ¸ì—”ë“œ (Next.js)]
         â”‚
         â”‚ REST API (JWT í† í°)
         â–¼
[ë°±ì—”ë“œ API (Express + TypeScript)]
    â”‚         â”‚         â”‚
    â”‚         â”‚         â”‚
    â–¼         â–¼         â–¼
[PostgreSQL] [ë°ì´í„° ìƒì„±] [íŒŒì¼ ì‹œìŠ¤í…œ]
  (Prisma)    ì—”ì§„        (multer)
              â”‚
              â”œâ”€ Excel íŒŒì‹± (ExcelJS)
              â”œâ”€ AI ë¶„ì„ (Claude API)
              â”œâ”€ ì½”í˜¸íŠ¸ ìƒì„± (Faker.js)
              â”œâ”€ ì´ë²¤íŠ¸ ìƒì„± (ì˜ì¡´ì„± ê´€ë¦¬)
              â””â”€ JSONL ì €ì¥ (Stream)
              â”‚
              â–¼
         [LogBus2]
         (child_process)
              â”‚
              â–¼
    [ThinkingEngine]
```

---

## ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ (í•µì‹¬)

| ì¹´í…Œê³ ë¦¬          | ê¸°ìˆ                         |
| ----------------- | --------------------------- |
| **ëŸ°íƒ€ì„**        | Node.js 20 + TypeScript     |
| **ì›¹ í”„ë ˆì„ì›Œí¬** | Express.js                  |
| **ë°ì´í„°ë² ì´ìŠ¤**  | PostgreSQL + Prisma ORM     |
| **ì¸ì¦**          | JWT + bcrypt                |
| **íŒŒì¼ ì²˜ë¦¬**     | multer, fs, Stream API      |
| **í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬** | child_process (spawn, exec) |
| **AI**            | Anthropic Claude SDK        |
| **ë”ë¯¸ ë°ì´í„°**   | Faker.js                    |
| **ì¸í”„ë¼**        | Docker Compose              |

---

## ğŸ“‹ API ì—”ë“œí¬ì¸íŠ¸ ìš”ì•½

### ì¸ì¦

- `POST /api/auth/register` - íšŒì›ê°€ì…
- `POST /api/auth/login` - ë¡œê·¸ì¸ (JWT ë°œê¸‰)
- `GET /api/auth/me` - ë‚´ ì •ë³´ ì¡°íšŒ

### ì‚¬ìš©ì ì„¤ì •

- `GET /api/user/settings` - ì„¤ì • ì¡°íšŒ
- `PUT /api/user/settings` - ì„¤ì • ì €ì¥

### ì‹¤í–‰ íˆìŠ¤í† ë¦¬

- `POST /api/generate/start` - ë°ì´í„° ìƒì„± ì‹œì‘
- `GET /api/runs` - ë‚´ ì‹¤í–‰ ëª©ë¡ (í˜ì´ì§•, í•„í„°ë§)
- `GET /api/runs/:runId` - ì‹¤í–‰ ìƒì„¸
- `DELETE /api/runs/:runId` - ì‹¤í–‰ ì‚­ì œ

### íŒŒì¼ ê´€ë¦¬

- `POST /api/files/upload` - íŒŒì¼ ì—…ë¡œë“œ
- `GET /api/files` - ë‚´ íŒŒì¼ ëª©ë¡
- `GET /api/files/:fileId/download` - ë‹¤ìš´ë¡œë“œ
- `DELETE /api/files/:fileId` - ì‚­ì œ

### ë°ì´í„° ì „ì†¡

- `POST /api/send-data/:runId` - ThinkingEngine ì „ì†¡

---

## ğŸ“š Node.js í•™ìŠµ ìš”ì†Œ (ì²´í¬ë¦¬ìŠ¤íŠ¸)

### âœ… ê¸°ë³¸ ê°œë…

- [x] Express.js REST API ì„œë²„ êµ¬ì¶•
- [x] ë¯¸ë“¤ì›¨ì–´ ì²´ì¸ (ì¸ì¦, CORS, JSON íŒŒì‹±)
- [x] ë¼ìš°íŠ¸ íŒŒë¼ë¯¸í„°, ì¿¼ë¦¬ìŠ¤íŠ¸ë§, body

### âœ… ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°

- [x] async/await íŒ¨í„´
- [x] Promise ì²´ì´ë‹
- [x] ì—ëŸ¬ í•¸ë“¤ë§ (try/catch)
- [x] ì½œë°± í•¨ìˆ˜

### âœ… íŒŒì¼ ì‹œìŠ¤í…œ

- [x] fs ëª¨ë“ˆ (ì½ê¸°/ì“°ê¸°/ì‚­ì œ)
- [x] Stream API (ëŒ€ìš©ëŸ‰ íŒŒì¼)
- [x] multer (íŒŒì¼ ì—…ë¡œë“œ)
- [x] path ëª¨ë“ˆ

### âœ… ë°ì´í„°ë² ì´ìŠ¤

- [x] Prisma ORM (íƒ€ì… ì•ˆì „ ì¿¼ë¦¬)
- [x] PostgreSQL ì—°ë™
- [x] ë§ˆì´ê·¸ë ˆì´ì…˜
- [x] ê´€ê³„í˜• ë°ì´í„° ëª¨ë¸ë§ (1:1, 1:N)

### âœ… í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬

- [x] child_process (spawn, exec)
- [x] ì™¸ë¶€ ë°”ì´ë„ˆë¦¬ ì‹¤í–‰
- [x] í”„ë¡œì„¸ìŠ¤ ëª¨ë‹ˆí„°ë§

### âœ… ë³´ì•ˆ

- [x] JWT í† í° ì¸ì¦
- [x] bcrypt ë¹„ë°€ë²ˆí˜¸ í•´ì‹±
- [x] API Key ì•”í˜¸í™” (AES-256)
- [x] SQL Injection ë°©ì§€

### âœ… ê¸°íƒ€

- [x] í™˜ê²½ë³€ìˆ˜ (dotenv)
- [x] ìŠ¤ì¼€ì¤„ë§ (setInterval)
- [x] HTTP í´ë¼ì´ì–¸íŠ¸ (AI API í˜¸ì¶œ)

---

## ğŸ¬ ë°ëª¨ ì‹œë‚˜ë¦¬ì˜¤

### 1ï¸âƒ£ íšŒì›ê°€ì… & ë¡œê·¸ì¸

```bash
POST /api/auth/register
â†’ ë¹„ë°€ë²ˆí˜¸ bcrypt í•´ì‹± â†’ DB ì €ì¥ â†’ "íšŒì›ê°€ì… ì™„ë£Œ"

POST /api/auth/login
â†’ ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ â†’ JWT ë°œê¸‰ â†’ "ë¡œê·¸ì¸ ì„±ê³µ"
```

### 2ï¸âƒ£ ë°ì´í„° ìƒì„±

```bash
POST /api/generate/start (JWT í¬í•¨)
â†’ Excel íŒŒì‹± â†’ AI ë¶„ì„ â†’ ìœ ì € ìƒì„± (Faker.js)
â†’ ì¼ìë³„ ì´ë²¤íŠ¸ ìƒì„± â†’ JSONL íŒŒì¼ ì €ì¥
â†’ DBì— Run + File ê¸°ë¡ â†’ "ìƒì„± ì™„ë£Œ"
```

### 3ï¸âƒ£ ì‹¤í–‰ íˆìŠ¤í† ë¦¬ ì¡°íšŒ

```bash
GET /api/runs?status=completed&limit=10
â†’ Prisma ì¿¼ë¦¬ â†’ ë‚´ ì‹¤í–‰ ëª©ë¡ ë°˜í™˜ (í˜ì´ì§•)
```

### 4ï¸âƒ£ ë°ì´í„° ì „ì†¡

```bash
POST /api/send-data/:runId
â†’ LogBus2 ì‹¤í–‰ (child_process)
â†’ gzip ì••ì¶• ì „ì†¡ â†’ ThinkingEngine â†’ "ì „ì†¡ ì™„ë£Œ"
```

---

## ğŸ“ˆ í”„ë¡œì íŠ¸ ì„±ê³¼

### ê¸°ìˆ ì  ì„±ê³¼

- âœ… **Express REST API** 20+ ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
- âœ… **PostgreSQL + Prisma** 4ê°œ í…Œì´ë¸” ì„¤ê³„
- âœ… **JWT ì¸ì¦** ì‹œìŠ¤í…œ êµ¬ì¶•
- âœ… **íŒŒì¼ ì²˜ë¦¬** (ì—…ë¡œë“œ, ìŠ¤íŠ¸ë¦¬ë°, ì‚­ì œ)
- âœ… **í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬** (LogBus2 ì œì–´)
- âœ… **ë¹„ë™ê¸° ì²˜ë¦¬** (ëŒ€ìš©ëŸ‰ ë°ì´í„° ìƒì„±)

### í•™ìŠµ ì„±ê³¼

- âœ… Node.js í•µì‹¬ API ìˆ™ë‹¬ (fs, child_process, stream)
- âœ… TypeScript íƒ€ì… ì•ˆì „ì„± ê²½í—˜
- âœ… Prisma ORM ë§ˆìŠ¤í„°
- âœ… ë³´ì•ˆ (JWT, bcrypt, ì•”í˜¸í™”)
- âœ… Docker ê¸°ë°˜ ê°œë°œ í™˜ê²½

---

## ğŸš€ ì‹¤í–‰ ë°©ë²• (ê°„ë‹¨)

```bash
# 1. PostgreSQL ì‹œì‘ (Docker)
docker-compose up -d

# 2. ì˜ì¡´ì„± ì„¤ì¹˜
cd data-generator && npm install

# 3. DB ë§ˆì´ê·¸ë ˆì´ì…˜
npx prisma migrate dev

# 4. ì„œë²„ ì‹œì‘
npm run api

# 5. API í…ŒìŠ¤íŠ¸
curl -X POST http://localhost:3001/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"test@test.com","password":"1234"}'
```

---

## ğŸ’¡ ê²°ë¡ 

### ì´ í”„ë¡œì íŠ¸ì—ì„œ ë°°ìš´ ê²ƒ

1. **Node.js ë°±ì—”ë“œ ê°œë°œì˜ ì „ì²´ íë¦„**
2. **Express REST API ì„¤ê³„ ë° êµ¬í˜„**
3. **PostgreSQL + Prisma ORM ì‹¤ë¬´ í™œìš©**
4. **JWT ê¸°ë°˜ ì¸ì¦ ì‹œìŠ¤í…œ êµ¬ì¶•**
5. **íŒŒì¼ ì‹œìŠ¤í…œ & í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬**
6. **ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë° íŒ¨í„´**
7. **ë³´ì•ˆ (ë¹„ë°€ë²ˆí˜¸ í•´ì‹±, API Key ì•”í˜¸í™”)**
8. **CRUD ì™„ë²½ êµ¬í˜„ (4ê°œ ë„ë©”ì¸)**

### Node.jsë¥¼ ì„ íƒí•œ ì´ìœ 

- âœ… ë¹„ë™ê¸° I/O â†’ ëŒ€ìš©ëŸ‰ íŒŒì¼ ì²˜ë¦¬ì— ìœ ë¦¬
- âœ… í’ë¶€í•œ ìƒíƒœê³„ (Express, Prisma, Multer ë“±)
- âœ… TypeScript ì§€ì› â†’ íƒ€ì… ì•ˆì „ì„±
- âœ… í”„ë¡ íŠ¸ì—”ë“œì™€ ê°™ì€ ì–¸ì–´ (JavaScript/TS)

---
